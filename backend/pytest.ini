[pytest]
# 测试目录
testpaths = tests

# 异步模式配置
asyncio_mode = auto

# 默认参数
addopts = 
    -v
    --strict-markers
    --tb=short
    -p no:warnings
    --timeout=60

# 测试标记
markers =
    unit: 单元测试 (快速，不需要外部服务)
    integration: 集成测试 (需要数据库等服务)
    e2e: 端到端测试 (完整流程)
    slow: 慢速测试
    auth: 认证相关测试
    kb: 知识库相关测试
    doc: 文档相关测试
    search: 搜索相关测试

# 环境变量
env =
    TESTING=1
    DATABASE_URL=postgresql+asyncpg://knowbase:knowbase123@localhost:5432/knowbase_test
    REDIS_URL=redis://localhost:6379/1
    
# 覆盖率配置
[coverage:run]
source = app
omit = 
    app/tasks/*
    */tests/*
    */__pycache__/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise NotImplementedError
    if TYPE_CHECKING:
